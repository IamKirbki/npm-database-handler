name: Version Check

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]
    
jobs:
  version-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "24.x"
          
      - name: Check version not already published
        run: |
          PACKAGE_VERSION=$(node -p "require('./package.json').version")
          NPM_VERSION=$(npm view $(node -p "require('./package.json').name") version 2>/dev/null || echo "0.0.0")
          echo "Package version: $PACKAGE_VERSION"
          echo "NPM registry version: $NPM_VERSION"
          if [ "$PACKAGE_VERSION" == "$NPM_VERSION" ]; then
            echo "Error: Version $PACKAGE_VERSION already exists on NPM"
            echo "Please bump the version in package.json before merging to main"
            exit 1
          fi
          echo "Version check passed: $PACKAGE_VERSION is new"